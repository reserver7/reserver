<?php
    include "product_code.php";
?>
<div id="subpage" :class="s1">
    <!-- 상품등록 부분 -->
    <form name="pd" id="pd" method="POST" action="p_insertok.php" enctype="multipart/form-data">
    <aside :class="s2">
        <label :class="s3">{{ part_1 }}</label>
        <div :class="s4">
            <ul :class="s5">
                <li>
                    <ol :class="s6">
                        <li>상품코드</li>
                        <li><input type="text" name="goodsno" id="goodsno" class="input_read" readonly></li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품명 *</li>
                        <li><input type="text" name="product_nm" id="product_nm" class="input_read2" maxlength="150"> ※ 상품명은 150자까지 등록이 가능합니다.</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>간편설명 *</li>
                        <li><input type="text" name="product_nmdtc" id="product_nmdtc" class="input_read5" maxlength="200"> ※ 최대 200자 이내</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>소비자 가격 *</li>
                        <li><input type="text" name="product_money" id="product_money" class="input_read" maxlength="8" value="0" style="text-align: right;"> 원</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 할인 유/무</li>
                        <li>
                            <label for="product_dc" class="product_dc"><input type="radio" name="product_dc" id="product_dc" value="Y" onclick="dc_ckeck(1);">적용</label>
                            <label for="product_dc2" class="product_dc"><input type="radio" name="product_dc" id="product_dc2" value="N" onclick="dc_ckeck(2);" checked>미적용</label>
                        </li>
                    </ol>
                </li>
                <li id="dc" style="display: none;">
                    <ol :class="s6">
                        <li>상품 할인율 *</li>
                        <li>
                            <label for="product_dcpart" class="product_dc"><input type="radio" name="product_dcpart" id="product_dcpart" value="P"> %단위</label>
                            <label for="product_dcpart2" class="product_dc"><input type="radio" name="product_dcpart" id="product_dcpart2" value="M" checked> 원단위</label>
                            <label class="product_dc" style="margin-left: 10px;"><input type="text" name="product_dcnum" id="product_dcnum" onkeyup="dc_num();" class="input_read tright"> 할인율</label>
                            <label class="product_dc" style="margin-left: 10px;">| 할인 최종금액 : <input type="text" name="product_sales" id="product_sales" class="input_read tright" readonly> 원</label>
                            <!-- 
                                %단위로 입력시
                                할인 최종금액 = 소비자 가격 * %단위 입력된 내용이 계산되어 할인 최종금액에 자동으로 입력되어야함
                                원단위 입력시
                                할인 최종금액 = 소비자 가격 - 원단위 입력된 내용이 계산되어 할인 최종금액에 적용됨
                            -->
                        </li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 제한수량 *</li>
                        <li><input type="text" name="product_ea" id="product_ea" class="input_read" value="0" maxlength="5"> ※ 수량 최대 입력값은 99999개 입니다.</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 대표이미지 *</li>
                        <li><input type="file" name="product_img" id="product_img"> ※ JPG,BMP,PNG,JPEG,GIF 2MB 이하만 업로드 가능합니다. (500 * 500)</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 옵션명</li>
                        <li>
                            <label class="product_dc">옵션명1 : <input type="text" name="product_option1" id="product_option1" class="input_read" value=""></label>
                            <label class="product_dc">옵션명2 : <input type="text" name="product_option2" id="product_option2" class="input_read" value=""></label>
                            <label class="product_dc">옵션명3 : <input type="text" name="product_option3" id="product_option3" class="input_read" value=""></label> ※ 미 입력시 옵션은 출력되지 않습니다.
                        </li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 URL</li>
                        <li><input type="text" name="product_url" id="product_url" class="input_read3" value=""> ※ 소셜에 공유하고 싶을 경우 URL을 입력해 주시면 됩니다.</li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 추가 이미지</li>
                        <li>
                            <label class="product_dc">
                            상품 추가이미지1 : <input type="file" name="product_img1" id="product_img1"> ※ 사이즈 500*500 JPG,BMP,PNG,JPEG,GIF 파일만 사용 가능합니다.<br>
                            &nbsp;상품 추가이미지2 : <input type="file" name="product_img2" id="product_img2"> ※ 사이즈 500*500 JPG,BMP,PNG,JPEG,GIF 파일만 사용 가능합니다.<br>
                            &nbsp;상품 추가이미지3 : <input type="file" name="product_img3" id="product_img3"> ※ 사이즈 500*500 JPG,BMP,PNG,JPEG,GIF 파일만 사용 가능합니다.
                            </label>
                        </li>
                    </ol>
                </li>
                <li>
                    <ol :class="s6">
                        <li>상품 상세설명 *</li>
                        <li>
                            <textarea name="product_contents1" id="product_contents1"></textarea>
                        </li>
                    </ol>
                </li>
            </ul>
        </div>
        <div :class="s7">
            <input type="button" value="등록완료" onclick="product_insertck(1)" :class="s8">
            <input type="button" value="등록취소" onclick="product_insertck(2)" :class="s9">
        </div>
    </aside>
</form>
</div>
<script>
    function product_insertck(pt){
        if(pt==1){
            var re_msg = insertck();
            if(re_msg[2]=="no"){
                alert(re_msg[0]);
                re_msg[1].focus();
            }
            else{
                insert_confirm()
            }
        }
        else{
            location.href = "./product_info.html";
        }
    }

    function insertck(){
        var p_msg = "";
        var p_focus = "";
        var p_ok = "yes";
        let editor = CKEDITOR.instances['product_contents1'];
        if(pd.product_nm.value==""){
            p_msg = "상품명을 입력해 주세요.";
            p_focus = pd.product_nm;
            p_ok = "no";
        }
        else if(pd.product_nmdtc.value==""){
            p_msg = "간편설명을 입력해 주세요.";
            p_focus = pd.product_nmdtc;
            p_ok = "no";
        }
        else if(pd.product_money.value=="0" || pd.product_money.value==""){
            p_msg = "소비자가격을 입력해 주세요.";
            p_focus = pd.product_money;
            p_ok = "no";
        }
        else if(document.getElementById("product_dc").checked==true && pd.product_dcnum.value==""){
            p_msg = "상품할인 적용시 할인율은 필수값 입니다.";
            p_focus = pd.product_dcnum;
            p_ok = "no";
        }
        else if(pd.product_ea.value=="0" || pd.product_ea.value==""){
            p_msg = "상품 수량을 입력해 주세요.";
            p_focus = pd.product_ea; 
            p_ok = "no";
        }
        else if(pd.product_img.value==""){
            p_msg = "상품 대표이미지를 첨부해 주세요.";
            p_focus = pd.product_img; 
            p_ok = "no";
        }
        else if(editor.getData()==""){
            p_msg = "상품 상세 설명을 입력해 주세요.";
            p_focus = editor;
            p_ok = "no";
        }
        return [p_msg,p_focus,p_ok];
    }

    function dc_ckeck(dc_number){
        if(dc_number==1){
            document.getElementById("dc").style.display = "block";
            pd.product_sales.value = pd.product_money.value;
        }
        else{
            document.getElementById("dc").style.display = "none";
            pd.product_dcnum.value = 0;
            pd.product_sales.value = 0;
        }
    }

    function dc_num(){
        var money = Number(pd.product_money.value);
        var dcnum = Number(pd.product_dcnum.value);
        pd.product_sales.value = money;
        if(document.getElementById("product_dcpart").checked==true){ //% 할인
            pd.product_sales.value = Math.floor(money - (money * (dcnum / 100)));
        }
        else{ //원단위 할인
            pd.product_sales.value = Math.floor(money - dcnum);
        }
    }

    function insert_confirm(){
        console.log(pd.product_money.value);
        if(pd.product_nm.value.length>150){
            alert("상품명은 150자까지 등록이 가능합니다.");
            pd.product_nm.focus();
            return false;
        }
        else if(pd.product_nmdtc.value.length>200){
            alert("간편설명은 200자까지 등록이 가능합니다.");
            pd.product_nmdtc.focus();
            return false;
        }
        else if(isNaN(pd.product_money.value)==true){
            alert("소비자 가격은 숫자만 입력 가능합니다.");
            pd.product_money.value = "";
            pd.product_money.focus();
            return false;
        }
        else if(isNaN(pd.product_ea.value)==true){
            alert("상품수량은 숫자만 입력 가능합니다.");
            pd.product_ea.value = "";
            pd.product_ea.focus();
            return false;
        }
        else if(pd.product_sales.value.match("-")){
            alert("할인율을 다시 확인해 주세요.");
            pd.product_sales.focus();
            return false;
        }
        else{
            pd.submit();
        }
    }

    let p_in = new Vue({
        el:"#subpage",
        data:{
            part_1 : "상품등록",
            s1:"subview",
            s2:"aside_css",
            s3:"part_css",
            s4:"chart_css",
            s5:"ul_insert",
            s6:"ol_insert",
            s7:"div_btn",
            s8:"btncss1",
            s9:"btncss2"
        }
    });
</script>
<script src="./ckeditor/ckeditor.js"></script>
<script>
    CKEDITOR.replace("product_contents1",{width:840,height:200});

    //상품코드 생성부분
    document.getElementById("goodsno").value = <?php echo $pnumber ?>;
</script>