<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-compatible" content="IE=Edge, Chrome=1">
<title>Jquery-Ajax (3일차)-Ajax + banner</title>
<script src="./jquery.js"></script>
<script>
    $(function(){
        //banner ajax 호출
        $.ajax({
            url:"./banner.json",
            cache:false,
            type:"GET",
            dataType:"json",
            success:function($result){
                //console.log($result.mainbanner.length);
                $.fn.html_make($result);
            },
            error:function(){
                console.log("접근이 잘못되었습니다.");   
            }
        });

        //배너 애니메이션 
        let $timer;
        let $index = 0; //디스크 초기값
        $.fn.times = function(){
            $timer = setTimeout(function $retimer(){
                var $ea = $("#banner>li").length;
                $("#banner>li").eq($index).stop().fadeOut();
                $index++;
                if($index>=$ea){
                    $index = 0;
                }
                $("#banner>li").eq($index).stop().fadeIn();
                //디스크
                $("#disc>li").css("background-color","black");
                $("#disc>li").eq($index).css("background-color","tomato");
                //console.log($index);
                clearTimeout($timer);
            $timer = setTimeout($retimer,5000);
            },5000);
        };
        $.fn.times();

        $.fn.html_make = function($array){  //배너 및 디스크 생성 부분
            $($array.mainbanner).each(function($node,$name){
                if($name[3]=="yes"){ //yes일때 출력 조건문
                    $("#banner").append("<li link="+$name[1]+"><img src='"+$name[0]+"'></li>");
                    $("#disc").append("<li></li> ");
                }
            });
            //디스크 버튼
            $("#disc>li").bind({
                "mouseenter":function(){
                    clearTimeout($timer);
                },
                "click":function(){
                    $("#banner>li").eq($index).stop().fadeOut();
                    $index = $(this).index();
                    $("#banner>li").eq($index).stop().fadeIn();
                    $("#disc>li").css("background-color","black");
                    $("#disc>li").eq($index).css("background-color","tomato");
                    //console.log($index);
                }
            });
            $("#banner>li").click(function(){
                var $url = $(this).attr("link");
                location.href = $url;
            });
        }

        $("#outline").bind({
            "mouseenter":function(){
                $(".svg").stop().fadeIn();
                clearTimeout($timer);
            },
            "mouseleave":function(){
                $(".svg").stop().fadeOut();
                $.fn.times();
            }
        });

        //left, right 버튼
        $("#right").click(function(){
            clearTimeout($timer);
            var $ea = $("#banner>li").length;
            $("#banner>li").eq($index).stop().fadeOut();
            $index++;
            if($index>=$ea){
                $index = 0;
            }
            $("#banner>li").eq($index).stop().fadeIn();
            //디스크
            $("#disc>li").css("background-color","black");
            $("#disc>li").eq($index).css("background-color","tomato");
            //console.log($index);
        }); 
        $("#left").click(function(){
            clearTimeout($timer);
            var $ea = $("#banner>li").length;
            $("#banner>li").eq($index).stop().fadeOut();
            $index--;
            if($index<0){
                $index = $ea-1;
            }
            $("#banner>li").eq($index).stop().fadeIn();
            //디스크
            $("#disc>li").css("background-color","black");
            $("#disc>li").eq($index).css("background-color","tomato");
            //console.log($index);
        });
    });
</script>
<style>
    body{ margin: 0; padding: 0;}
    *{box-sizing: border-box;}
    .sectioncss{ height: auto;}
    .outline{
        width: 1000px; height: 450px;  margin: 0 auto;
        position: relative; overflow: hidden; border: 1px solid black;
    }
    /* 배너 */
    .banner { 
        width: 100%; height: 450px; list-style: none; margin: 0; padding: 0; 
        position: relative;
    }
    .banner > li { 
        width: 1000px; height: 450px; position: absolute; display: none;
    }
    .banner > li:nth-of-type(1){ display: block; }
    /* 디스크 */
    .disc{
        width: 100%; height: 15px; list-style: none; margin: 0; padding: 0;
        text-align: center; position: absolute; z-index: 20; 
        left: 0;  bottom: 10px; 
    }
    .disc > li {
        width: 15px; height: 15px; background-color: black; border-radius: 50%;
        display: inline-block; cursor: pointer;
    }
    .disc > li:nth-of-type(1){ background-color: tomato;}
    /* 좌우버튼 */
    .svg { 
        display: block; position: absolute; z-index: 10; display: none;
        width: 60px; height: 60px; top: 50%; margin-top: -30px;
        cursor: pointer;
    }
    .svg:nth-of-type(1){ left:3px;}
    .svg:nth-of-type(2){ right:3px;}
    .svg >img { width: 100%; }
</style>
</head>
<body>
<section class="sectioncss">
<div class="outline" id="outline">
    <span class="svg" id="left"><img src="./left.svg"></span>
    <span class="svg" id="right"><img src="./right.svg"></span>
    <!--배너-->
    <ul class="banner" id="banner">

    </ul>
    <!--디스크-->
    <ol class="disc" id="disc">

    </ol>
</div>
</section>
</body>
</html>